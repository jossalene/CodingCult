---
title: "chap7.data_analysis"
author: "Hanh Nguyen"
date: "4/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### CHAPTER 7: EXPLORATORY DATA ANALYSIS ###

____________
INTRODUCTION
____________

Exploratory Data Analysis = EDA
```{r}
#load tidyverse
library(tidyverse)
```
- Goal:
    . To develop an understanding of your data by using questions as tools to guide your investigation so that focusing on a specific part of your dataset to decide which graphs, models, or transformations to make.
    . Ask quality questions to generate a large quantity of questions.
    
- Questions to look at:
    1. What type of variation occurs within my variables?
    2. What tyoe of covariation occurs between my variables?

- Definition:
    . Variable: a quantity, quality or property that you can measure
    . Value: the state of a variable when you measure it 
              --> Value may change from measurement to measurement
    . Observation: a set of measurements made under similar conditions.
                  An observations will contain several values, each associated with a different
                  variable.
                  ---> Observation can be referred as a data point.
    . Tabular data: a set of values, each associates with a variable and an observation.
            - Is *tidy* if each value is placed in its own "cell", each variable in its own column, and each observation in its own row

_________
Variation
_________
. Variation is the tendency of the values ofa variable to change from measurement to measurement.
        - It is true when measuring quantities, categoricals, or even across different subjects.
        - Every variable has its own pattern of variation

**Visualising distributions**

. Categorical variable : bar chart
                          - height : how many observations occurred with each x value
                          - compute using dplyr::count()
```{r}
ggplot(data=diamonds) + geom_bar(mapping=aes(x=cut))
diamonds %>% count(cut)
```

. Continuous variable  : histogram
  - date/time            - devides the x-axis into equally spaced bins, then, use the height
                            of a bar to display the nuber of observaions that fall in each
                            bin.
                          - if wish to overlay multiple histograms in the same plot
                            -> use geom-freqpoly() - same calculation but displaying the counts
                                with bars using lines instead
  - compute by combining dplyr::count() and ggplot2::cut_width()
```{r}
ggplot(data=diamonds) + geom_histogram(mapping=aes(x=carat), binwidth = 0.5)
diamonds %>% count(cut_width(carat, 0.5))
ggplot(data = diamonds, mapping = aes(x = carat, color = cut)) + geom_freqpoly(binwidth=0.1)
```
  
**Typical values**
. In both bar charts and histograms, tall bars show the common values of a variable, 
  and shorter bars show less common values. Places that do not have bars reveal values 
  that were not seen.
    - Useful questions: Most common? Rare? Why? Unusual patterns? Explain.
. Clusters of similar values suggest that subgroups exist.
    - Useful questions: Similliar? Different? Explain & describe. Misleading?
    
**Unusual values**
. Outliers are observations that are unusual, data points that don't seem to fit the pattern.
    - Either wrong dat entry or important new science.
    - coord_cartesian() : make it easy to see to unusual values
            ~ xlim() : zoom in x axis
            ~ ylim() : zoom in y axis
```{r}
# regular graph
ggplot(diamonds) + geom_histogram(aes(x = y), binwidth = 0.5)
# zoom in graph with coord_cartersian()
ggplot(diamonds) + 
  geom_histogram(aes(x = y), binwidth = 0.5) + 
  coord_cartesian(ylim = c(0, 50))
```

______________
Missing Values
______________
. Encountering unusual values:
    1. Drop the entire row with the strange values
        -> not recommended
    2. Replacing the unusual values with missing values.
        -> recommended
          - *mutate()* to replace the variable with a modified copy
          - *ifelse()* to replace unusual values with NA
                    ~ test : a logical vector
                    ~ yes : result of test if test is TRUE
                    ~ no : result of test if test is FALSE
                Alternative: *dplyr::case_when()* - creates a new
                                    variable that relies on a complex
                                    combination of existing variables.

```{r}
diamonds
# option1: drop entire row
diamonds2 <- diamonds %>% 
  filter(between(y, 3, 20))
diamonds2
# option2: replacing with NA
diamonds3 <- diamonds %>% 
  mutate(y = ifelse(y < 3 | y > 20, NA, y))
# plot with missing value
ggplot(data = diamonds3, mapping = aes(x = x, y = y)) + 
  geom_point()
# Suppress warning as missing values are removed, set na.rm = TRUE.
ggplot(data = diamonds3, mapping = aes(x = x, y = y)) + 
  geom_point(na.rm = TRUE)
```

___________
Covariation
___________
. Variation describes the behavior within a variable.
. Covariation describes the behavior between variables.
. Covariation is the tendency for the values of two or more variables
  to vary together in a related way.

**A categorical and continuous variable**
. Display *density*, which is the count standardized so that the area
  under each frequency polygon is one -> make comparison easier.
```{r}
ggplot(data = diamonds, mapping = aes(x = price, y = ..density..)) +
  geom_freqpoly(mapping = aes(color = cut), binwidth = 500)
```
. *Boxplot* -  a type of visual shorthand for a distribution of
              values, consisting:
                ~ A box that stretches from the 25th percentile of the
                  distribution to the 75th percentile, a distance 
                  known as the interquartile range (IQR). In the 
                  middle of the box is a line that displays the 
                  median, ie 50th percentile, of the distribution.
                  --> the spread of the distribution, whether or not
                      the distribution is symmetric about the median
                      or skewed to one side.
                ~ Visual points that display observation that fall
                  more than 1.5 times the IQR from either edge of the
                  box. These outlying point are unusual so are plotted
                  individually
                ~ A line (or whisker) that extends from each end of
                  the box and goes to the farthest non-outlier point
                  in the distribution
```{r}
ggplot(diamonds, aes(x=cut, y=price)) + geom_boxplot()
```
. *coord_flip()* - flip the coordinate 90degree

________________________
EXERCISE 7.3 - VARIATION
________________________
###1.    Explore the distribution of each of the x, y, and z variables in diamonds. What do you learn? Think about a diamond and how you might decide which dimension is the length, width, and depth.
```{r}
diamonds
# transform diamonds from wide format to long format
diamonds_long <- gather(diamonds, side, measurment, x:z, factor_key = TRUE)
diamonds_long
# plot diamonds in long format
ggplot(diamonds_long, aes(x = measurment)) + geom_histogram(aes(fill=side))
```
--> x is length, y is width, z is depth.

###2.    Explore the distribution of price. Do you discover anything unusual or surprising? (Hint: Carefully think about the binwidth and make sure you try a wide range of values.)
```{r}
#Distribution of the price based on the color of the diamond
ggplot(diamonds, aes(x = price, color = color)) + geom_freqpoly()
# Distribution of the price based on the cut of the diamond
ggplot(diamonds, aes(x = price, color = cut)) + geom_freqpoly()
# Distribution of price in general in the range from $1000 to $2000
ggplot(diamonds, aes(x = price)) + geom_freqpoly() + xlim(c(1000, 2000))
```
--> It seems that there is no diamond which has price around $1500.

###3.    How many diamonds are 0.99 carat? How many are 1 carat? What do you think is the cause of the difference?
```{r}
# Count diamonds in 0.99 carat.
diamonds %>% filter(carat == 0.99) %>% count()
# Count diamonds in 1 carat.
diamonds %>% filter(carat == 1) %>% count()
# plot
ggplot(diamonds, aes(x = carat)) + geom_histogram() + xlim(c(0.97, 1.05))
```
--> There is much more 1 carat than 0.99 carat. It's probably because most people prefer buying their diamond in whole countable units.

###4.    Compare and contrast coord_cartesian() vs xlim() or ylim() when zooming in on a histogram. What happens if you leave binwidth unset? What happens if you try and zoom so only half a bar shows?
```{r}
# xlim
ggplot(diamonds, aes(x = carat)) + geom_histogram(binwidth = 0.01) + xlim(c(0.97, 1.05))
# coor_cartesian()
ggplot(diamonds, aes(x = carat)) + geom_histogram(binwidth = 0.01) + coord_cartesian(xlim = c(0.97, 1.05))
```
--> xlim select the range first and plot the value in the range, thus the plot doesn't look continuous outside of the range
--> with coord_cartesian, the plot looks more continous to values outside of the range.

_______________________________
EXERCISE 7.4 - Missing Values
_______________________________
    
###1.    What happens to missing values in a histogram? What happens to missing values in a bar chart? Why is there a difference?
---> Historgram removes missing value on plot.
---> Bar chart contain missing value on plot as another catergory.

###2.    What does na.rm = TRUE do in mean() and sum()?
---> na.rm = TRUE ignore NA when calculating mean and sum

______________________________________________________
EXERCISE 7.5.1 - A categorical and continuous variable
______________________________________________________
###1.    Use what you’ve learned to improve the visualisation of the departure times of cancelled vs. non-cancelled flights.
```{r}
flights %>% 
  mutate(canceled_flight = is.na(dep_time) | is.na(arr_time)) %>%
  ggplot() + geom_boxplot(aes(x=canceled_flight, y=dep_time))
```

###2.    What variable in the diamonds dataset is most important for predicting the price of a diamond? How is that variable correlated with cut? Why does the combination of those two relationships lead to lower quality diamonds being more expensive?
```{r}
diamonds
# Carat and cut
ggplot(diamonds, aes(x= cut, y=carat)) + geom_boxplot()
# Carat, price and cut
ggplot(diamonds, aes(x=carat, y=price, color=cut)) + geom_point()
```
--> Carat is the most important variable to predict diamond price
    because more lower quality diamonds are produced in heavier carat.

###3.    Install the ggstance package, and create a horizontal boxplot. How does this compare to using coord_flip()?
```{r}
install.packages("ggstance")
library(ggstance)
ggplot(diamonds, aes(x= cut, y=carat)) + 
  geom_boxplot() + 
  coord_flip()
ggplot(diamonds, aes(x= carat, y=cut)) + 
  geom_boxploth()
```
--> They both give the same return

###4.    One problem with boxplots is that they were developed in an era of much smaller datasets and tend to display a prohibitively large number of “outlying values”. One approach to remedy this problem is the letter value plot. Install the lvplot package, and try using geom_lv() to display the distribution of price vs cut. What do you learn? How do you interpret the plots?
```{r}
#install.packages("lvplot")
library(lvplot)
ggplot(diamonds, aes(x=cut, y=price)) + geom_lv()
```
--> The letter value plot shows more quantile compared to boxplot

###5.    Compare and contrast geom_violin() with a facetted geom_histogram(), or a coloured geom_freqpoly(). What are the pros and cons of each method?
```{r}
ggplot(diamonds, aes(x=cut, y=price)) + geom_violin()
ggplot(diamonds, aes(x=price)) + geom_histogram() + facet_wrap(~cut)
ggplot(diamonds, aes(x=price, color=cut)) + geom_freqpoly() 
```
--> geom_violin give the best display for density while geom_freqpoly() can illustrate the price distribution in different cuts at the same time.On the other hand, geom_histogram() more focus on price distribution

###6.    If you have a small dataset, it’s sometimes useful to use geom_jitter() to see the relationship between a continuous and categorical variable. The ggbeeswarm package provides a number of methods similar to geom_jitter(). List them and briefly describe what each one does.
```{r}
#install.packages("ggbeeswarm")
library(ggbeeswarm)
ggplot(diamonds, aes(x=cut, y=price)) + 
  geom_jitter(size=0.1, color="pink")
ggplot(diamonds, aes(x=cut, y=price)) + geom_beeswarm()
```
-->`geom_quasirandom()` produces plots that are a mix of jitter 
                        and violin plots. There are several different
                        methods that determine exactly how the random
                        location of the points is generated.
-->`geom_beeswarm()` produces a plot similar to a violin plot, but 
                    by offsetting the points.
